<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Simple Two-User Chat App</title>
<!-- Include Firebase library (compatibility version) -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
<style>
  /* Add your styles here */
  #messages {
    height: 200px;
    overflow-y: scroll;
    border: 1px solid #ccc;
    padding: 5px;
    margin-bottom: 10px;
  }
  #message-input {
    width: 100%;
    margin-bottom: 10px;
  }
  #text-upload-container {
    margin-bottom: 10px;
  }
  #uploaded-text {
    white-space: pre-wrap; /* Since text files preserve line breaks */
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    padding: 5px;
    margin-bottom: 10px;
    height: 200px;
    overflow-y: scroll;
  }
  .highlight {
    background-color: yellow;
  }
</style>
</head>
<body>
<div id="chat-container">
  <input type="text" id="username" placeholder="Enter your name" required>
  <div id="text-upload-container">
    <input type="file" id="text-upload" accept=".txt" onchange="loadTextFile()">
    <input type="search" id="search-text" placeholder="Search text" oninput="searchText()">
  </div>
  <div id="uploaded-text"></div>
  <textarea id="message-input" rows="4" placeholder="Type a message" required></textarea>
  <button onclick="sendMessage()">Send</button>
  <div id="messages"></div>
</div>

<script>
  // Your web app's Firebase configuration
  // (Use your actual configuration details here)
const firebaseConfig = {
  apiKey: "AIzaSyDjoJLs5aBD6STfreiO09ciYbIC-zcHACg",
  authDomain: "chatassist-3a97b.firebaseapp.com",
  projectId: "chatassist-3a97b",
  storageBucket: "chatassist-3a97b.appspot.com",
  messagingSenderId: "604892006338",
  appId: "1:604892006338:web:933b8f8ea78389defe385b",
  measurementId: "G-SLR0WFQPPS"
};

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let userName = '';

  document.getElementById('username').addEventListener('change', function() {
    userName = this.value;
  });

  // Function to send message
  function sendMessage() {
    const messageInput = document.getElementById('message-input');
    const message = messageInput.value.trim();
    if (message && userName) {
      db.collection("messages").add({
        name: userName,
        text: message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        messageInput.value = '';
      })
      .catch((error) => {
        console.error("Error writing message: ", error);
      });
    } else if (!userName) {
      alert('Please enter your name.');
    } else {
      alert('Please type a message.');
    }
  }

  // Function to load and display the text file
  function loadTextFile() {
    const fileInput = document.getElementById('text-upload');
    const file = fileInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('uploaded-text').textContent = e.target.result;
      };
      reader.readAsText(file);
    }
  }

  // Function to search and highlight text
  function searchText() {
    let text = document.getElementById('uploaded-text').textContent;
    let searchQuery = document.getElementById('search-text').value;
    const textContainer = document.getElementById('uploaded-text');

    // Remove previous highlights
    textContainer.innerHTML = text;

    // Escape special characters
    searchQuery = searchQuery.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');

    // Highlight new search terms
    if (searchQuery) {
      const pattern = new RegExp(`(${searchQuery})`, 'gi');
      const newText = text.replace(pattern, '<span class="highlight">$1</span>');
      textContainer.innerHTML = newText;
    }
  }

  // Real-time listener for chat
  db.collection("messages").orderBy("timestamp")
    .onSnapshot((querySnapshot) => {
      const messagesContainer = document.getElementById('messages');
      messagesContainer.innerHTML = ''; // Clear current messages
      querySnapshot.forEach((doc) => {
        const messageDiv = document.createElement('div');
        messageDiv.textContent = `${doc.data().name}: ${doc.data().text}`;
        messagesContainer.appendChild(messageDiv);
      });
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    });
</script>
</body>
</html>
